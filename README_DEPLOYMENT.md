# Cloudflare Pages Deployment Guide

## ⚠️ CRITICAL: Current Issue

Your site is currently serving **source files** instead of **built files**. This causes 404 errors like `/js/populate.js` not found.

**The fix:** Set the **Build output directory** to `dist` in Cloudflare Pages dashboard.

## Build Configuration

Cloudflare Pages **MUST** be configured with these exact settings:

- **Build command:** `npm run build`
- **Build output directory:** `dist` ⚠️ **THIS IS CRITICAL**
- **Root directory:** 
  - If your GitHub repo root is `Plex.Final/`, leave empty or set to `/`
  - If your GitHub repo root is the parent directory, set to `Plex.Final`
- **Node version:** 18 or higher

## Setup Steps

1. **Go to Cloudflare Pages Dashboard**
   - Navigate to your project → Settings → Builds & deployments

2. **Configure Build Settings:**
   ```
   Build command: npm run build
   Build output directory: dist
   Root directory: (see above)
   ```

3. **Set Environment Variables:**
   - `NODE_VERSION`: `18` (or higher)

4. **Save and Redeploy:**
   - Save settings
   - Trigger a new deployment
   - Check build logs to verify `dist/` is being generated

## Verification

After deployment, verify:

1. **Check Build Logs:**
   - Should see: `npm run build` completing successfully
   - Should see: Files being generated in `dist/`

2. **Test the Site:**
   - Visit `https://pkcollection.net`
   - Open browser DevTools → Network tab
   - Check that JavaScript files load from `/assets/js/` (not `/src/js/`)
   - Should see files like `/assets/js/main.js` and `/assets/js/populate--[hash].js`

3. **If Still Broken:**
   - Check that `dist/index.html` exists in build logs
   - Verify `dist/` folder structure matches expected output
   - Ensure all source files are committed to GitHub

## Important Notes

- The `dist/` folder is in `.gitignore` (correct - it's generated during build)
- Cloudflare Pages will automatically run `npm install` and `npm run build`
- The built files in `dist/` are what get deployed (NOT `src/`)
- The `_redirects` file in `public/` gets copied to `dist/` during build

## Troubleshooting

### Problem: 404 errors for `/js/populate.js` or `/src/js/*`
**Cause:** Cloudflare Pages is serving source files instead of built files  
**Solution:** Set "Build output directory" to `dist` in Cloudflare Pages settings

### Problem: Build fails
**Check:**
- Build logs for error messages
- `package.json` exists and has correct scripts
- Node version is 18+
- All source files are committed to GitHub

### Problem: Assets load but pages are blank
**Check:**
- Browser console for JavaScript errors
- Network tab for failed requests
- Verify `dist/index.html` has correct script tags pointing to `/assets/js/`

## File Structure

```
Plex.Final/
├── src/              # Source files (committed to GitHub)
│   ├── index.html    # Source HTML (references /src/js/)
│   └── js/           # Source JavaScript
├── dist/             # Build output (NOT committed, generated by Cloudflare)
│   ├── index.html    # Built HTML (references /assets/js/)
│   └── assets/       # Built assets with hashed filenames
├── public/           # Static files (committed, copied to dist)
├── package.json      # Dependencies
└── vite.config.js    # Build configuration
```

## Testing Locally

Before deploying, test the build:

```bash
cd Plex.Final
npm install
npm run build
npm run preview
```

Visit `http://localhost:4173` and verify everything works. This should match what Cloudflare Pages serves.

